<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì | ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹°</title>
  <meta name="description" content="ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.">
  <meta name="keywords" content="ê¸°í”„íŠ¸ìƒµ, ê´€ë¦¬ì, ê²Œì‹œíŒ, íšŒì›ê´€ë¦¬, ì»¤ë®¤ë‹ˆí‹°">
  <link rel="canonical" href="https://hallowed-hulking-scooter.glitch.me/admin.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="ê´€ë¦¬ì | ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹°">
  <meta property="og:description" content="ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.">
  <meta property="og:url" content="https://hallowed-hulking-scooter.glitch.me/admin.html">
  <meta property="og:image" content="https://hallowed-hulking-scooter.glitch.me/img/Starbucks.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ê´€ë¦¬ì | ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹°">
  <meta name="twitter:description" content="ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.">
  <meta name="twitter:image" content="https://hallowed-hulking-scooter.glitch.me/img/Starbucks.png">
  <link rel="icon" href="/img/cu.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/cu.png">
  <meta name="robots" content="noindex, nofollow">
  <meta name="theme-color" content="#2563eb">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì",
    "url": "https://hallowed-hulking-scooter.glitch.me/admin.html",
    "description": "ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.",
    "inLanguage": "ko-KR"
  }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
    .admin-table th, .admin-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom-width: 1px;
      border-color: #e5e7eb; /* gray-200 */
    }
    .admin-table th {
      background-color: #f9fafb; /* gray-50 */
      font-weight: 600; /* semibold */
    }
    .modal-content {
        max-height: 80vh;
        overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <div id="top-banner" class="w-full bg-blue-600 text-white text-center py-3 px-2 flex items-center justify-center relative">
    <svg class="w-5 h-5 mr-2 inline-block text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z"/></svg>
    <span class="font-semibold">ì¶”ê°€ê²°ì œ: íœ´ëŒ€í°ê²°ì œë§¤ì… ì¹´ë“œê²°ì œë§¤ì…! <a href="https://pf.kakao.com/_SBFexb/chat" target="_blank" rel="noopener" class="underline hover:text-yellow-200 ml-1">ì¦‰ì‹œìƒë‹´</a></span>
    <button onclick="document.getElementById('top-banner').style.display='none'" class="absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-yellow-200 text-xl font-bold">&times;</button>
  </div>

  <header class="bg-slate-800 text-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <a href="admin.html" class="text-2xl font-bold">ê¸°í”„íŠ¸ìƒµ ê´€ë¦¬ì</a>
        </div>
        <div class="flex items-center">
          <span id="admin-nickname-display" class="mr-4 hidden"></span>
          <button id="admin-logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded-md text-sm font-medium hidden">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <!-- ìƒí’ˆ ê´€ë¦¬ ì„¹ì…˜ -->
    <section id="product-management-section" class="bg-white shadow sm:rounded-lg p-6 mt-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">ìƒí’ˆ ê´€ë¦¬</h2>
      <form id="add-product-form" class="flex flex-wrap gap-2 mb-4">
        <input type="text" id="product-name" placeholder="ìƒí’ˆëª…" class="border rounded p-2 flex-1 min-w-[120px]">
        <input type="text" id="product-image" placeholder="ì´ë¯¸ì§€ ê²½ë¡œ (ì˜ˆ: img/Starbucks.png)" class="border rounded p-2 flex-1 min-w-[180px]">
        <input type="text" id="product-price" placeholder="ê°€ê²© (ì˜ˆ: 50,000ì›)" class="border rounded p-2 flex-1 min-w-[100px]">
        <input type="text" id="product-link" placeholder="êµ¬ë§¤ë§í¬(ì„ íƒ)" class="border rounded p-2 flex-1 min-w-[180px]">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ìƒí’ˆ ì¶”ê°€</button>
      </form>
      <div id="product-add-error" class="text-red-500 text-sm mb-2 hidden"></div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 admin-table">
          <thead class="bg-gray-50">
            <tr>
              <th>ID</th><th>ìƒí’ˆëª…</th><th>ì´ë¯¸ì§€</th><th>ê°€ê²©</th><th>êµ¬ë§¤ë§í¬</th><th>ì‘ì—…</th>
            </tr>
          </thead>
          <tbody id="admin-product-list" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <div id="admin-product-empty" class="text-gray-500 text-center py-8 hidden"><p>ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
    </section>

    <!-- ê²Œì‹œê¸€ ê´€ë¦¬ ì„¹ì…˜ -->
    <section id="post-management-section" class="bg-white shadow sm:rounded-lg p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">ê²Œì‹œê¸€ ê´€ë¦¬</h2>
      <div class="mb-4 flex gap-2">
        <select id="post-filter-category" class="border rounded p-2">
          <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
          <option value="tech">ğŸ’» ê¸°ìˆ </option>
          <option value="finance">ğŸ’° ê¸ˆìœµ</option>
          <option value="lifestyle">ğŸ  ë¼ì´í”„ìŠ¤íƒ€ì¼</option>
          <option value="news">ğŸ“° ë‰´ìŠ¤</option>
          <option value="hot">ğŸ”¥ í•« ì´ìŠˆ</option>
        </select>
        <input type="text" id="post-search" placeholder="ì œëª© ë˜ëŠ” ë‚´ìš© ê²€ìƒ‰..." class="border rounded p-2 flex-1">
        <button id="refresh-posts-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">ìƒˆë¡œê³ ì¹¨</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 admin-table">
          <thead class="bg-gray-50">
            <tr>
              <th>ID</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ì¹´í…Œê³ ë¦¬</th><th>ì¡°íšŒìˆ˜</th><th>ì¢‹ì•„ìš”</th><th>ì‘ì„±ì¼</th><th>ì‘ì—…</th>
            </tr>
          </thead>
          <tbody id="admin-post-list" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <div id="admin-post-empty" class="text-gray-500 text-center py-8 hidden">
        <p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    </section>

    <!-- íšŒì› ê´€ë¦¬ ì„¹ì…˜ -->
    <section id="user-management-section" class="bg-white shadow sm:rounded-lg p-6 mt-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">íšŒì› ê´€ë¦¬</h2>
      <div class="mb-4 flex gap-2">
        <input type="text" id="user-search" placeholder="ë‹‰ë„¤ì„ ë˜ëŠ” ì´ë©”ì¼ ê²€ìƒ‰..." class="border rounded p-2 flex-1">
        <button id="refresh-users-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">ìƒˆë¡œê³ ì¹¨</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 admin-table">
          <thead class="bg-gray-50">
            <tr>
              <th>ë‹‰ë„¤ì„</th><th>ì´ë©”ì¼</th><th>ê°€ì…ì¼</th><th>ì¢‹ì•„ìš”í•œ ê¸€</th><th>ìƒíƒœ</th><th>ì‘ì—…</th>
            </tr>
          </thead>
          <tbody id="admin-user-list" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
      <div id="admin-user-empty" class="text-gray-500 text-center py-8 hidden">
        <p>ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    </section>
  </main>

  <!-- ê²Œì‹œê¸€ ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="edit-post-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto modal-content">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-gray-800">ê²Œì‹œê¸€ ìˆ˜ì •</h3>
        <button id="close-edit-modal" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
      </div>
      
      <form id="edit-post-form" class="space-y-4">
        <input type="hidden" id="edit-post-id">
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬</label>
          <select id="edit-post-category" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
            <option value="tech">ğŸ’» ê¸°ìˆ </option>
            <option value="finance">ğŸ’° ê¸ˆìœµ</option>
            <option value="lifestyle">ğŸ  ë¼ì´í”„ìŠ¤íƒ€ì¼</option>
            <option value="news">ğŸ“° ë‰´ìŠ¤</option>
            <option value="hot">ğŸ”¥ í•« ì´ìŠˆ</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª©</label>
          <input type="text" id="edit-post-title" required 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ì‘ì„±ì</label>
          <input type="text" id="edit-post-author" required 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ë‚´ìš©</label>
          <textarea id="edit-post-content" rows="10" required
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
          <input type="text" id="edit-post-tags" 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="flex items-center gap-4">
          <label class="flex items-center">
            <input type="checkbox" id="edit-post-featured" class="mr-2">
            <span class="text-sm text-gray-700">ğŸ”¥ í•« ì´ìŠˆë¡œ ë“±ë¡</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" id="edit-post-auto" class="mr-2">
            <span class="text-sm text-gray-700">ğŸ¤– ìë™ ì—…ë°ì´íŠ¸ í—ˆìš©</span>
          </label>
        </div>
        
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" id="cancel-edit-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition">
            ì·¨ì†Œ
          </button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
            ìˆ˜ì • ì™„ë£Œ
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- íšŒì› ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="edit-user-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto modal-content">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-gray-800">íšŒì› ì •ë³´ ìˆ˜ì •</h3>
        <button id="close-edit-user-modal" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
      </div>
      
      <form id="edit-user-form" class="space-y-4">
        <input type="hidden" id="edit-user-original-nickname">
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ë‹‰ë„¤ì„</label>
          <input type="text" id="edit-user-nickname" required 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë©”ì¼</label>
          <input type="email" id="edit-user-email" required 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ì„¸ìš”)</label>
          <input type="password" id="edit-user-password" 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"
                 placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ê°€ì…ì¼</label>
          <input type="text" id="edit-user-joined" readonly 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-50">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ ìˆ˜</label>
          <input type="text" id="edit-user-liked-count" readonly 
                 class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-50">
        </div>
        
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" id="cancel-edit-user-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition">
            ì·¨ì†Œ
          </button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
            ìˆ˜ì • ì™„ë£Œ
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // API ì„œë²„ ì£¼ì†Œ
    const API_BASE_URL = 'http://localhost:4000/api'; // ë¡œì»¬ ì„œë²„ë¡œ ë³€ê²½
    
    // --- ê²Œì‹œê¸€ ê´€ë¦¬ ë¡œì§ ---
    let allPosts = [];
    let filteredPosts = [];
    
    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ê²Œì‹œê¸€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    function loadBlogPosts() {
      try {
        const savedPosts = localStorage.getItem('blogPosts');
        return savedPosts ? JSON.parse(savedPosts) : [];
      } catch (e) {
        console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', e);
        return [];
      }
    }
    
    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ê²Œì‹œê¸€ ë°ì´í„° ì €ì¥
    function saveBlogPosts() {
      try {
        localStorage.setItem('blogPosts', JSON.stringify(allPosts));
      } catch (e) {
        console.error('ê²Œì‹œê¸€ ì €ì¥ ì‹¤íŒ¨:', e);
      }
    }
    
    // ì¹´í…Œê³ ë¦¬ ì •ë³´ ë°˜í™˜
    function getCategoryInfo(category) {
      const categories = {
        hot: { label: 'ğŸ”¥ í•« ì´ìŠˆ', class: 'bg-red-100 text-red-700' },
        tech: { label: 'ğŸ’» ê¸°ìˆ ', class: 'bg-blue-100 text-blue-700' },
        finance: { label: 'ğŸ’° ê¸ˆìœµ', class: 'bg-green-100 text-green-700' },
        lifestyle: { label: 'ğŸ  ë¼ì´í”„ìŠ¤íƒ€ì¼', class: 'bg-purple-100 text-purple-700' },
        news: { label: 'ğŸ“° ë‰´ìŠ¤', class: 'bg-yellow-100 text-yellow-700' }
      };
      return categories[category] || { label: 'ğŸ“‹ ê¸°íƒ€', class: 'bg-gray-100 text-gray-700' };
    }
    
    // ê²Œì‹œê¸€ ëª©ë¡ ë Œë”ë§
    function renderAdminPostList(posts) {
      const listEl = document.getElementById('admin-post-list');
      const emptyEl = document.getElementById('admin-post-empty');
      
      if (!listEl || !emptyEl) return;
      
      listEl.innerHTML = '';
      
      if (!posts || posts.length === 0) {
        emptyEl.classList.remove('hidden');
        return;
      }
      
      emptyEl.classList.add('hidden');
      
      posts.forEach(post => {
        const categoryInfo = getCategoryInfo(post.category);
        const createdDate = new Date(post.createdAt).toLocaleDateString('ko-KR');
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="font-mono text-sm">${post.id}</td>
          <td class="max-w-xs truncate" title="${post.title}">${post.title}</td>
          <td>${post.author}</td>
          <td>
            <span class="px-2 py-1 rounded-full text-xs font-medium ${categoryInfo.class}">
              ${categoryInfo.label}
            </span>
          </td>
          <td class="text-center">${post.views.toLocaleString()}</td>
          <td class="text-center">${post.likes}</td>
          <td class="text-sm text-gray-600">${createdDate}</td>
          <td class="space-x-2">
            <button class="text-blue-600 hover:text-blue-900 text-sm admin-edit-post-btn" data-id="${post.id}">ìˆ˜ì •</button>
            <button class="text-red-600 hover:text-red-900 text-sm admin-delete-post-btn" data-id="${post.id}">ì‚­ì œ</button>
          </td>
        `;
        listEl.appendChild(tr);
      });
      
      // ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-edit-post-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const postId = parseInt(this.dataset.id);
          openEditPostModal(postId);
        });
      });
      
      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-delete-post-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const postId = parseInt(this.dataset.id);
          deletePost(postId);
        });
      });
    }
    
    // ê²Œì‹œê¸€ í•„í„°ë§
    function filterPosts() {
      const categoryFilter = document.getElementById('post-filter-category').value;
      const searchTerm = document.getElementById('post-search').value.toLowerCase();
      
      filteredPosts = allPosts.filter(post => {
        const matchesCategory = !categoryFilter || post.category === categoryFilter;
        const matchesSearch = !searchTerm || 
          post.title.toLowerCase().includes(searchTerm) ||
          post.content.toLowerCase().includes(searchTerm);
        return matchesCategory && matchesSearch;
      });
      
      renderAdminPostList(filteredPosts);
    }
    
    // ê²Œì‹œê¸€ ë¡œë“œ
    function loadAllPosts() {
      allPosts = loadBlogPosts();
      filteredPosts = [...allPosts];
      renderAdminPostList(filteredPosts);
    }
    
    // ê²Œì‹œê¸€ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    function openEditPostModal(postId) {
      const post = allPosts.find(p => p.id === postId);
      if (!post) {
        alert('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      document.getElementById('edit-post-id').value = post.id;
      document.getElementById('edit-post-category').value = post.category;
      document.getElementById('edit-post-title').value = post.title;
      document.getElementById('edit-post-author').value = post.author;
      document.getElementById('edit-post-content').value = post.content;
      document.getElementById('edit-post-tags').value = post.tags.join(', ');
      document.getElementById('edit-post-featured').checked = post.featured || false;
      document.getElementById('edit-post-auto').checked = post.auto || false;
      
      document.getElementById('edit-post-modal').classList.remove('hidden');
    }
    
    // ê²Œì‹œê¸€ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
    function closeEditPostModal() {
      document.getElementById('edit-post-modal').classList.add('hidden');
      document.getElementById('edit-post-form').reset();
    }
    
    // ê²Œì‹œê¸€ ìˆ˜ì •
    function updatePost(postData) {
      const postIndex = allPosts.findIndex(p => p.id === postData.id);
      if (postIndex === -1) {
        alert('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ê¸°ì¡´ ê²Œì‹œê¸€ ë°ì´í„° ìœ ì§€í•˜ë©´ì„œ ìˆ˜ì •
      allPosts[postIndex] = {
        ...allPosts[postIndex],
        ...postData,
        updatedAt: new Date().toISOString()
      };
      
      saveBlogPosts();
      loadAllPosts();
      closeEditPostModal();
      alert('ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // ê²Œì‹œê¸€ ì‚­ì œ
    function deletePost(postId) {
      const post = allPosts.find(p => p.id === postId);
      if (!post) {
        alert('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (!confirm(`"${post.title}" ê²Œì‹œê¸€ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      allPosts = allPosts.filter(p => p.id !== postId);
      saveBlogPosts();
      loadAllPosts();
      alert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // --- ìƒí’ˆ ê´€ë¦¬ ë¡œì§ë§Œ ë‚¨ê¹€ ---
    async function fetchAllProducts() {
      try {
        const res = await fetch(`${API_BASE_URL}/products`);
        if (!res.ok) return [];
        return await res.json();
      } catch (e) { return []; }
    }
    function renderAdminProductList(products) {
      const listEl = document.getElementById('admin-product-list');
      const emptyEl = document.getElementById('admin-product-empty');
      if (!listEl || !emptyEl) return;
      listEl.innerHTML = '';
      if (!products || products.length === 0) {
        emptyEl.classList.remove('hidden');
        return;
      }
      emptyEl.classList.add('hidden');
      products.forEach(product => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${product.id}</td>
          <td><input type="text" value="${product.name}" class="border rounded p-1 w-32 admin-edit-product-name"></td>
          <td><input type="text" value="${product.image}" class="border rounded p-1 w-40 admin-edit-product-image"></td>
          <td><input type="text" value="${product.price}" class="border rounded p-1 w-20 admin-edit-product-price"></td>
          <td><input type="text" value="${product.link || ''}" class="border rounded p-1 w-40 admin-edit-product-link"></td>
          <td class="space-x-2">
            <button class="text-blue-600 hover:text-blue-900 text-sm admin-save-product-btn" data-id="${product.id}">ì €ì¥</button>
            <button class="text-red-600 hover:text-red-900 text-sm admin-delete-product-btn" data-id="${product.id}">ì‚­ì œ</button>
          </td>
        `;
        listEl.appendChild(tr);
      });
      // ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-save-product-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
          const id = this.dataset.id;
          const tr = this.closest('tr');
          const name = tr.querySelector('.admin-edit-product-name').value.trim();
          const image = tr.querySelector('.admin-edit-product-image').value.trim();
          const price = tr.querySelector('.admin-edit-product-price').value.trim();
          const link = tr.querySelector('.admin-edit-product-link').value.trim();
          if (!name || !image || !price) { alert('í•„ìˆ˜ í•­ëª© ëˆ„ë½'); return; }
          const res = await fetch(`${API_BASE_URL}/products/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, image, price, link })
          });
          const result = await res.json();
          if (result.success) { alert('ì €ì¥ë¨'); loadAllProducts(); }
          else alert(result.error || 'ì €ì¥ ì‹¤íŒ¨');
        });
      });
      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-delete-product-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
          const id = this.dataset.id;
          if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
          const res = await fetch(`${API_BASE_URL}/products/${id}`, { method: 'DELETE' });
          const result = await res.json();
          if (result.success) { alert('ì‚­ì œë¨'); loadAllProducts(); }
          else alert(result.error || 'ì‚­ì œ ì‹¤íŒ¨');
        });
      });
    }
    async function loadAllProducts() {
      const products = await fetchAllProducts();
      renderAdminProductList(products);
    }
    // ìƒí’ˆ ì¶”ê°€ í¼ ì´ë²¤íŠ¸
    const addProductForm = document.getElementById('add-product-form');
    if (addProductForm) {
      addProductForm.onsubmit = async function(e) {
        e.preventDefault();
        const name = document.getElementById('product-name').value.trim();
        const image = document.getElementById('product-image').value.trim();
        const price = document.getElementById('product-price').value.trim();
        const link = document.getElementById('product-link').value.trim();
        const errorDiv = document.getElementById('product-add-error');
        errorDiv.classList.add('hidden');
        if (!name || !image || !price) {
          errorDiv.textContent = 'ìƒí’ˆëª…, ì´ë¯¸ì§€, ê°€ê²©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.';
          errorDiv.classList.remove('hidden');
          return;
        }
        const res = await fetch(`${API_BASE_URL}/products`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, image, price, link })
        });
        const result = await res.json();
        if (result.id) {
          addProductForm.reset();
          loadAllProducts();
        } else {
          errorDiv.textContent = result.error || 'ìƒí’ˆ ì¶”ê°€ ì‹¤íŒ¨';
          errorDiv.classList.remove('hidden');
        }
      };
    }
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // ê²Œì‹œê¸€ ê´€ë¦¬ ì´ˆê¸°í™”
      loadAllPosts();
      
      // ê²Œì‹œê¸€ í•„í„° ì´ë²¤íŠ¸
      document.getElementById('post-filter-category').addEventListener('change', filterPosts);
      document.getElementById('post-search').addEventListener('input', filterPosts);
      document.getElementById('refresh-posts-btn').addEventListener('click', loadAllPosts);
      
      // ê²Œì‹œê¸€ ìˆ˜ì • ëª¨ë‹¬ ì´ë²¤íŠ¸
      document.getElementById('close-edit-modal').addEventListener('click', closeEditPostModal);
      document.getElementById('cancel-edit-btn').addEventListener('click', closeEditPostModal);
      
      // ê²Œì‹œê¸€ ìˆ˜ì • í¼ ì œì¶œ
      document.getElementById('edit-post-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const postData = {
          id: parseInt(document.getElementById('edit-post-id').value),
          category: document.getElementById('edit-post-category').value,
          title: document.getElementById('edit-post-title').value.trim(),
          author: document.getElementById('edit-post-author').value.trim(),
          content: document.getElementById('edit-post-content').value.trim(),
          tags: document.getElementById('edit-post-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
          featured: document.getElementById('edit-post-featured').checked,
          auto: document.getElementById('edit-post-auto').checked
        };
        
        if (!postData.title || !postData.content || !postData.author) {
          alert('ì œëª©, ë‚´ìš©, ì‘ì„±ìëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
          return;
        }
        
        updatePost(postData);
      });
      
      // íšŒì› ê´€ë¦¬ ì´ˆê¸°í™”
      loadAllUsers();
      
      // íšŒì› í•„í„° ì´ë²¤íŠ¸
      document.getElementById('user-search').addEventListener('input', filterUsers);
      document.getElementById('refresh-users-btn').addEventListener('click', loadAllUsers);
      
      // íšŒì› ìˆ˜ì • ëª¨ë‹¬ ì´ë²¤íŠ¸
      document.getElementById('close-edit-user-modal').addEventListener('click', closeEditUserModal);
      document.getElementById('cancel-edit-user-btn').addEventListener('click', closeEditUserModal);
      
      // íšŒì› ìˆ˜ì • í¼ ì œì¶œ
      document.getElementById('edit-user-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const userData = {
          originalNickname: document.getElementById('edit-user-original-nickname').value,
          nickname: document.getElementById('edit-user-nickname').value.trim(),
          email: document.getElementById('edit-user-email').value.trim(),
          password: document.getElementById('edit-user-password').value.trim()
        };
        
        if (!userData.nickname || !userData.email) {
          alert('ë‹‰ë„¤ì„ê³¼ ì´ë©”ì¼ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
          return;
        }
        
        // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(userData.email)) {
          alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        updateUser(userData);
      });
      
      // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          if (!document.getElementById('edit-post-modal').classList.contains('hidden')) {
            closeEditPostModal();
          }
          if (!document.getElementById('edit-user-modal').classList.contains('hidden')) {
            closeEditUserModal();
          }
        }
      });
      
      // ìƒí’ˆ ê´€ë¦¬ ì´ˆê¸°í™”
      loadAllProducts();
    });
    
    // --- íšŒì› ê´€ë¦¬ ë¡œì§ ---
    let allUsers = [];
    let filteredUsers = [];
    
    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ëª¨ë“  íšŒì› ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    function loadAllUsers() {
      try {
        allUsers = [];
        
        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ëª¨ë“  í‚¤ë¥¼ í™•ì¸í•˜ì—¬ ì‚¬ìš©ì ë°ì´í„° ì°¾ê¸°
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('blogUser_')) {
            try {
              const userData = JSON.parse(localStorage.getItem(key));
              if (userData && userData.nickname && userData.email) {
                allUsers.push({
                  ...userData,
                  storageKey: key
                });
              }
            } catch (e) {
              console.error(`ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ (${key}):`, e);
            }
          }
        }
        
        // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë„ ì¶”ê°€ (blogUser í‚¤)
        const currentUserData = localStorage.getItem('blogUser');
        if (currentUserData) {
          try {
            const userData = JSON.parse(currentUserData);
            if (userData && userData.nickname && userData.email) {
              // ì¤‘ë³µ ì²´í¬
              const exists = allUsers.some(user => user.nickname === userData.nickname);
              if (!exists) {
                allUsers.push({
                  ...userData,
                  storageKey: 'blogUser'
                });
              }
            }
          } catch (e) {
            console.error('í˜„ì¬ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
          }
        }
        
        filteredUsers = [...allUsers];
        renderAdminUserList(filteredUsers);
        
      } catch (e) {
        console.error('íšŒì› ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
        allUsers = [];
        filteredUsers = [];
        renderAdminUserList([]);
      }
    }
    
    // íšŒì› ëª©ë¡ ë Œë”ë§
    function renderAdminUserList(users) {
      const listEl = document.getElementById('admin-user-list');
      const emptyEl = document.getElementById('admin-user-empty');
      
      if (!listEl || !emptyEl) return;
      
      listEl.innerHTML = '';
      
      if (!users || users.length === 0) {
        emptyEl.classList.remove('hidden');
        return;
      }
      
      emptyEl.classList.add('hidden');
      
      users.forEach(user => {
        const joinedDate = user.joinedAt ? new Date(user.joinedAt).toLocaleDateString('ko-KR') : 'ì •ë³´ ì—†ìŒ';
        const likedCount = user.likedPosts ? user.likedPosts.length : 0;
        const status = user.storageKey === 'blogUser' ? 'í˜„ì¬ ë¡œê·¸ì¸' : 'ì¼ë°˜ íšŒì›';
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="font-medium">${user.nickname}</td>
          <td>${user.email}</td>
          <td class="text-sm text-gray-600">${joinedDate}</td>
          <td class="text-center">${likedCount}ê°œ</td>
          <td>
            <span class="px-2 py-1 rounded-full text-xs font-medium ${user.storageKey === 'blogUser' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
              ${status}
            </span>
          </td>
          <td class="space-x-2">
            <button class="text-blue-600 hover:text-blue-900 text-sm admin-edit-user-btn" data-nickname="${user.nickname}">ìˆ˜ì •</button>
            <button class="text-red-600 hover:text-red-900 text-sm admin-delete-user-btn" data-nickname="${user.nickname}" ${user.storageKey === 'blogUser' ? 'disabled' : ''}>ì‚­ì œ</button>
          </td>
        `;
        listEl.appendChild(tr);
      });
      
      // ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-edit-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const nickname = this.dataset.nickname;
          openEditUserModal(nickname);
        });
      });
      
      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-delete-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const nickname = this.dataset.nickname;
          if (!this.disabled) {
            deleteUser(nickname);
          }
        });
      });
    }
    
    // íšŒì› í•„í„°ë§
    function filterUsers() {
      const searchTerm = document.getElementById('user-search').value.toLowerCase();
      
      filteredUsers = allUsers.filter(user => {
        return !searchTerm || 
          user.nickname.toLowerCase().includes(searchTerm) ||
          user.email.toLowerCase().includes(searchTerm);
      });
      
      renderAdminUserList(filteredUsers);
    }
    
    // íšŒì› ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    function openEditUserModal(nickname) {
      const user = allUsers.find(u => u.nickname === nickname);
      if (!user) {
        alert('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      document.getElementById('edit-user-original-nickname').value = user.nickname;
      document.getElementById('edit-user-nickname').value = user.nickname;
      document.getElementById('edit-user-email').value = user.email;
      document.getElementById('edit-user-password').value = '';
      document.getElementById('edit-user-joined').value = user.joinedAt ? new Date(user.joinedAt).toLocaleString('ko-KR') : 'ì •ë³´ ì—†ìŒ';
      document.getElementById('edit-user-liked-count').value = user.likedPosts ? user.likedPosts.length : 0;
      
      document.getElementById('edit-user-modal').classList.remove('hidden');
    }
    
    // íšŒì› ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
    function closeEditUserModal() {
      document.getElementById('edit-user-modal').classList.add('hidden');
      document.getElementById('edit-user-form').reset();
    }
    
    // íšŒì› ì •ë³´ ìˆ˜ì •
    function updateUser(userData) {
      const originalNickname = userData.originalNickname;
      const user = allUsers.find(u => u.nickname === originalNickname);
      
      if (!user) {
        alert('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ (ë³¸ì¸ ì œì™¸)
      if (userData.nickname !== originalNickname) {
        const nicknameExists = allUsers.some(u => u.nickname === userData.nickname && u.nickname !== originalNickname);
        if (nicknameExists) {
          alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.');
          return;
        }
      }
      
      // ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (ë³¸ì¸ ì œì™¸)
      if (userData.email !== user.email) {
        const emailExists = allUsers.some(u => u.email === userData.email && u.nickname !== originalNickname);
        if (emailExists) {
          alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
          return;
        }
      }
      
      // ì‚¬ìš©ì ë°ì´í„° ì—…ë°ì´íŠ¸
      const updatedUser = {
        ...user,
        nickname: userData.nickname,
        email: userData.email,
        updatedAt: new Date().toISOString()
      };
      
      // ë¹„ë°€ë²ˆí˜¸ê°€ ì…ë ¥ë˜ì—ˆìœ¼ë©´ ì—…ë°ì´íŠ¸
      if (userData.password) {
        updatedUser.password = userData.password;
      }
      
      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
      try {
        // ê¸°ì¡´ í‚¤ ì‚­ì œ (ë‹‰ë„¤ì„ì´ ë³€ê²½ëœ ê²½ìš°)
        if (user.storageKey && user.storageKey !== 'blogUser') {
          localStorage.removeItem(user.storageKey);
        }
        
        // ìƒˆ í‚¤ë¡œ ì €ì¥
        const newStorageKey = user.storageKey === 'blogUser' ? 'blogUser' : `blogUser_${updatedUser.nickname}`;
        localStorage.setItem(newStorageKey, JSON.stringify(updatedUser));
        
        // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì¸ ê²½ìš° blogUserë„ ì—…ë°ì´íŠ¸
        if (user.storageKey === 'blogUser') {
          localStorage.setItem('blogUser', JSON.stringify(updatedUser));
        }
        
        // ê²Œì‹œê¸€ì—ì„œ ì‘ì„±ì ì´ë¦„ë„ ì—…ë°ì´íŠ¸ (ë‹‰ë„¤ì„ì´ ë³€ê²½ëœ ê²½ìš°)
        if (userData.nickname !== originalNickname) {
          updatePostsAuthor(originalNickname, userData.nickname);
        }
        
        loadAllUsers();
        closeEditUserModal();
        alert('íšŒì› ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        
      } catch (e) {
        console.error('íšŒì› ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', e);
        alert('íšŒì› ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ê²Œì‹œê¸€ ì‘ì„±ì ì´ë¦„ ì—…ë°ì´íŠ¸
    function updatePostsAuthor(oldNickname, newNickname) {
      try {
        const posts = loadBlogPosts();
        let updated = false;
        
        posts.forEach(post => {
          if (post.author === oldNickname) {
            post.author = newNickname;
            updated = true;
          }
        });
        
        if (updated) {
          localStorage.setItem('blogPosts', JSON.stringify(posts));
        }
      } catch (e) {
        console.error('ê²Œì‹œê¸€ ì‘ì„±ì ì´ë¦„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', e);
      }
    }
    
    // íšŒì› ì‚­ì œ
    function deleteUser(nickname) {
      const user = allUsers.find(u => u.nickname === nickname);
      if (!user) {
        alert('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (user.storageKey === 'blogUser') {
        alert('í˜„ì¬ ë¡œê·¸ì¸í•œ íšŒì›ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (!confirm(`"${user.nickname}" íšŒì›ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ íšŒì›ì´ ì‘ì„±í•œ ê²Œì‹œê¸€ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      try {
        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚­ì œ
        if (user.storageKey) {
          localStorage.removeItem(user.storageKey);
        }
        
        loadAllUsers();
        alert('íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        
      } catch (e) {
        console.error('íšŒì› ì‚­ì œ ì‹¤íŒ¨:', e);
        alert('íšŒì› ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }
  </script>
</body>
</html>
