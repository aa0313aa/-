<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì | ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹°</title>
  <meta name="description" content="ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.">
  <meta name="keywords" content="ê¸°í”„íŠ¸ìƒµ, ê´€ë¦¬ì, ê²Œì‹œíŒ, íšŒì›ê´€ë¦¬, ì»¤ë®¤ë‹ˆí‹°">
  <link rel="canonical" href="https://hallowed-hulking-scooter.glitch.me/admin.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="ê´€ë¦¬ì | ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹°">
  <meta property="og:description" content="ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.">
  <meta property="og:url" content="https://hallowed-hulking-scooter.glitch.me/admin.html">
  <meta property="og:image" content="https://hallowed-hulking-scooter.glitch.me/img/Starbucks.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ê´€ë¦¬ì | ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹°">
  <meta name="twitter:description" content="ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.">
  <meta name="twitter:image" content="https://hallowed-hulking-scooter.glitch.me/img/Starbucks.png">
  <link rel="icon" href="/img/cu.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/cu.png">
  <meta name="robots" content="noindex, nofollow">
  <meta name="theme-color" content="#2563eb">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì",
    "url": "https://hallowed-hulking-scooter.glitch.me/admin.html",
    "description": "ê¸°í”„íŠ¸ìƒµ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í˜ì´ì§€. ê²Œì‹œê¸€ ë° íšŒì› ê´€ë¦¬.",
    "inLanguage": "ko-KR"
  }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
    .admin-table th, .admin-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom-width: 1px;
      border-color: #e5e7eb; /* gray-200 */
    }
    .admin-table th {
      background-color: #f9fafb; /* gray-50 */
      font-weight: 600; /* semibold */
    }
    .modal-content {
        max-height: 80vh;
        overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <header class="bg-slate-800 text-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <a href="admin.html" class="text-2xl font-bold">ê¸°í”„íŠ¸ìƒµ ê´€ë¦¬ì</a>
        </div>
        <div class="flex items-center">
          <span id="admin-nickname-display" class="mr-4 hidden"></span>
          <button id="admin-logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded-md text-sm font-medium hidden">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <section id="admin-login-section" class="bg-white shadow sm:rounded-lg p-6 mb-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
      <div class="space-y-3">
        <input type="text" id="admin-login-nickname" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2" placeholder="ê´€ë¦¬ì ë‹‰ë„¤ì„">
        <input type="password" id="admin-login-password" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button id="admin-login-submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          ë¡œê·¸ì¸
        </button>
        <div id="admin-login-error" class="text-red-500 text-sm mt-2 hidden"></div>
      </div>
    </section>

    <div id="admin-dashboard" class="hidden">
      <section id="post-management-section" class="bg-white shadow sm:rounded-lg p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">ê²Œì‹œë¬¼ ê´€ë¦¬</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 admin-table">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col">ID</th>
                <th scope="col">ì‘ì„±ì</th>
                <th scope="col">ë‚´ìš© (ì¼ë¶€)</th>
                <th scope="col">ì‘ì„±ì¼</th>
                <th scope="col">ìƒíƒœ</th>
                <th scope="col">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="admin-post-list" class="bg-white divide-y divide-gray-200">
              </tbody>
          </table>
        </div>
        <div id="admin-post-empty" class="text-gray-500 text-center py-8 hidden">
          <p>ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      </section>
      
      <section id="user-management-section" class="bg-white shadow sm:rounded-lg p-6 mt-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">íšŒì› ê´€ë¦¬</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 admin-table">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col">ID</th>
                <th scope="col">ë‹‰ë„¤ì„</th>
                <th scope="col">ì´ë¦„</th>
                <th scope="col">ìƒë…„ì›”ì¼</th>
                <th scope="col">ì—°ë½ì²˜</th>
                <th scope="col">ì´ë©”ì¼</th>
                <th scope="col">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="admin-user-list" class="bg-white divide-y divide-gray-200"></tbody>
          </table>
        </div>
        <div id="admin-user-empty" class="text-gray-500 text-center py-8 hidden">
          <p>íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      </section>

      <section id="product-management-section" class="bg-white shadow sm:rounded-lg p-6 mt-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">ìƒí’ˆ ê´€ë¦¬</h2>
        <form id="add-product-form" class="flex flex-wrap gap-2 mb-4">
          <input type="text" id="product-name" placeholder="ìƒí’ˆëª…" class="border rounded p-2 flex-1 min-w-[120px]">
          <input type="text" id="product-image" placeholder="ì´ë¯¸ì§€ ê²½ë¡œ (ì˜ˆ: img/Starbucks.png)" class="border rounded p-2 flex-1 min-w-[180px]">
          <input type="text" id="product-price" placeholder="ê°€ê²© (ì˜ˆ: 50,000ì›)" class="border rounded p-2 flex-1 min-w-[100px]">
          <input type="text" id="product-link" placeholder="êµ¬ë§¤ë§í¬(ì„ íƒ)" class="border rounded p-2 flex-1 min-w-[180px]">
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ìƒí’ˆ ì¶”ê°€</button>
        </form>
        <div id="product-add-error" class="text-red-500 text-sm mb-2 hidden"></div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 admin-table">
            <thead class="bg-gray-50">
              <tr>
                <th>ID</th><th>ìƒí’ˆëª…</th><th>ì´ë¯¸ì§€</th><th>ê°€ê²©</th><th>êµ¬ë§¤ë§í¬</th><th>ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="admin-product-list" class="bg-white divide-y divide-gray-200"></tbody>
          </table>
        </div>
        <div id="admin-product-empty" class="text-gray-500 text-center py-8 hidden"><p>ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
      </section>
    </div>

    <div id="edit-post-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] hidden p-4">
      <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg modal-content">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-gray-900">ê²Œì‹œë¬¼ ìˆ˜ì • (ID: <span id="edit-post-id-display"></span>)</h3>
          <button id="edit-post-modal-close" class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>
        </div>
        <form id="edit-post-form">
          <input type="hidden" id="edit-post-id">
          <div class="mb-4">
            <label for="edit-post-writer" class="block text-sm font-medium text-gray-700">ì‘ì„±ì</label>
            <input type="text" id="edit-post-writer" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm p-2 bg-gray-100" readonly>
          </div>
          <div class="mb-4">
            <label for="edit-post-content" class="block text-sm font-medium text-gray-700">ë‚´ìš©</label>
            <textarea id="edit-post-content" rows="5" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm p-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
          <div class="mb-4">
            <label class="flex items-center">
              <input type="checkbox" id="edit-post-private" class="form-checkbox h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
              <span class="ml-2 text-sm text-gray-700">ë¹„ê³µê°œ</span>
            </label>
          </div>
          <div id="edit-post-error" class="text-red-500 text-sm mb-3 hidden"></div>
          <div class="flex justify-end gap-3">
            <button type="button" id="edit-post-cancel" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300">ì·¨ì†Œ</button>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">ìˆ˜ì • ì™„ë£Œ</button>
          </div>
        </form>
      </div>
    </div>

    <!-- íšŒì› ìƒì„¸/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="edit-user-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] hidden p-4">
      <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg modal-content">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-gray-900">íšŒì› ì •ë³´ (ID: <span id="edit-user-id-display"></span>)</h3>
          <button id="edit-user-modal-close" class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>
        </div>
        <form id="edit-user-form">
          <input type="hidden" id="edit-user-id">
          <div class="mb-4">
            <label for="edit-user-nickname" class="block text-sm font-medium text-gray-700">ë‹‰ë„¤ì„</label>
            <input type="text" id="edit-user-nickname" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm p-2 bg-gray-100" readonly>
          </div>
          <div class="mb-4">
            <label for="edit-user-realname" class="block text-sm font-medium text-gray-700">ì´ë¦„</label>
            <input type="text" id="edit-user-realname" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm p-2">
          </div>
          <div class="mb-4">
            <label for="edit-user-birth" class="block text-sm font-medium text-gray-700">ìƒë…„ì›”ì¼</label>
            <input type="text" id="edit-user-birth" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm p-2">
          </div>
          <div class="mb-4">
            <label for="edit-user-contact" class="block text-sm font-medium text-gray-700">ì—°ë½ì²˜</label>
            <input type="text" id="edit-user-contact" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm p-2">
          </div>
          <div class="mb-4">
            <label for="edit-user-email" class="block text-sm font-medium text-gray-700">ì´ë©”ì¼</label>
            <input type="email" id="edit-user-email" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm p-2">
          </div>
          <div id="edit-user-error" class="text-red-500 text-sm mb-3 hidden"></div>
          <div class="flex justify-end gap-3">
            <button type="button" id="edit-user-cancel" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300">ì·¨ì†Œ</button>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">ìˆ˜ì • ì™„ë£Œ</button>
            <button type="button" id="delete-user-btn" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">íšŒì› ì‚­ì œ</button>
          </div>
        </form>
      </div>
    </div>

  </main>

  <script>
    // API ì„œë²„ ì£¼ì†Œë¥¼ ë¡œì»¬ ê°œë°œí™˜ê²½ì— ë§ê²Œ ìˆ˜ì •
    const API_BASE_URL = 'https://hallowed-hulking-scooter.glitch.me/api'; 
    const ADMIN_NICKNAME = 'admin'; // ê´€ë¦¬ìë¡œ ê°„ì£¼í•  ë‹‰ë„¤ì„ (ë³´ì•ˆìƒ ë§¤ìš° ì·¨ì•½, ì‹¤ì œ ìš´ì˜ ì‹œ ë³€ê²½)

    // --- ê´€ë¦¬ì ì¸ì¦ ê´€ë ¨ ---
    function isAdminLoggedIn() {
      return localStorage.getItem('giftshop_admin_login') === 'true' && localStorage.getItem('giftshop_admin_nickname') === ADMIN_NICKNAME;
    }

    function getAdminNickname() {
      return localStorage.getItem('giftshop_admin_nickname');
    }

    function updateAdminUI() {
      const adminLoginSection = document.getElementById('admin-login-section');
      const adminDashboard = document.getElementById('admin-dashboard');
      const adminNicknameDisplay = document.getElementById('admin-nickname-display');
      const adminLogoutBtn = document.getElementById('admin-logout-btn');

      if (isAdminLoggedIn()) {
        adminLoginSection.classList.add('hidden');
        adminDashboard.classList.remove('hidden');
        adminNicknameDisplay.textContent = `${getAdminNickname()}ë‹˜ (ê´€ë¦¬ì)`;
        adminNicknameDisplay.classList.remove('hidden');
        adminLogoutBtn.classList.remove('hidden');
        loadAllPostsForAdmin();
        loadAllUsersForAdmin(); // íšŒì› ëª©ë¡ë„ í•¨ê»˜ ë¶ˆëŸ¬ì˜¤ê¸°
        loadAllProducts(); // ìƒí’ˆ ëª©ë¡ë„ ë¶ˆëŸ¬ì˜¤ê¸°
      } else {
        adminLoginSection.classList.remove('hidden');
        adminDashboard.classList.add('hidden');
        adminNicknameDisplay.classList.add('hidden');
        adminLogoutBtn.classList.add('hidden');
      }
    }
    
    const adminLoginSubmitBtn = document.getElementById('admin-login-submit');
    if(adminLoginSubmitBtn) {
        adminLoginSubmitBtn.onclick = async function() {
            const nickname = document.getElementById('admin-login-nickname').value.trim();
            const password = document.getElementById('admin-login-password').value;
            const errorDiv = document.getElementById('admin-login-error');
            errorDiv.classList.add('hidden');

            if (!nickname || !password) {
                errorDiv.textContent = 'ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
                errorDiv.classList.remove('hidden');
                return;
            }

            // ğŸš¨ ì¤‘ìš”: ì‹¤ì œ ê´€ë¦¬ì ì¸ì¦ì€ ë°˜ë“œì‹œ ì„œë²„ì—ì„œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.
            // ì´ ì½”ë“œëŠ” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ADMIN_NICKNAMEê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ë§Œ í™•ì¸í•˜ëŠ” ë§¤ìš° ê°„ë‹¨í•œ ë°©ì‹ì…ë‹ˆë‹¤.
            // ì‹¤ì œë¡œëŠ” ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚´ê³ , ì„œë²„ê°€ ê´€ë¦¬ì ì—¬ë¶€ë¥¼ íŒë³„ í›„ í† í° ë“±ì„ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
            try {
                const res = await fetch(`${API_BASE_URL}/login`, { // ì¼ë°˜ ë¡œê·¸ì¸ API ì‚¬ìš© (ë°ëª¨ìš©)
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nickname, password })
                });
                const data = await res.json();

                if (data.success && nickname === ADMIN_NICKNAME) {
                    localStorage.setItem('giftshop_admin_login', 'true');
                    localStorage.setItem('giftshop_admin_nickname', nickname);
                    // ì¼ë°˜ ì‚¬ìš©ì localStorageì™€ êµ¬ë¶„í•˜ê¸° ìœ„í•´ admin_ ì ‘ë‘ì‚¬ ì‚¬ìš©
                    // localStorage.setItem('giftshop_admin_token', data.token || '');
                    updateAdminUI();
                } else if (data.success && nickname !== ADMIN_NICKNAME) {
                    errorDiv.textContent = 'ê´€ë¦¬ì ê³„ì •ì´ ì•„ë‹™ë‹ˆë‹¤.';
                    errorDiv.classList.remove('hidden');
                } else {
                    errorDiv.textContent = data.error || 'ë¡œê·¸ì¸ ì‹¤íŒ¨. ë‹‰ë„¤ì„ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Admin login error:', error);
                errorDiv.textContent = `ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}. API ì„œë²„(${API_BASE_URL}) ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.`;
                errorDiv.classList.remove('hidden');
            }
        };
    }

    const adminLogoutBtn = document.getElementById('admin-logout-btn');
    if(adminLogoutBtn) {
        adminLogoutBtn.onclick = function() {
            if (confirm('ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('giftshop_admin_login');
                localStorage.removeItem('giftshop_admin_nickname');
                // localStorage.removeItem('giftshop_admin_token');
                updateAdminUI();
            }
        };
    }


    // --- ê²Œì‹œë¬¼ ê´€ë¦¬ ë¡œì§ ---
    async function fetchAllPostsForAdmin() {
        // ğŸš¨ ì¤‘ìš”: ê´€ë¦¬ìê°€ ëª¨ë“  ê¸€(ë¹„ê³µê°œ í¬í•¨)ì„ ë³´ë ¤ë©´,
        //    ë°±ì—”ë“œ API(/api/posts)ê°€ ìš”ì²­ìê°€ ê´€ë¦¬ìì„ì„ ì¸ì§€í•˜ê³  ëª¨ë“  ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •ë˜ê±°ë‚˜,
        //    ê´€ë¦¬ì ì „ìš© API ì—”ë“œí¬ì¸íŠ¸(ì˜ˆ: /api/admin/all-posts)ê°€ í•„ìš”í•©ë‹ˆë‹¤.
        //    í˜„ì¬ëŠ” ì¼ë°˜ ì‚¬ìš©ìì™€ ë™ì¼í•œ APIë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ, ë¹„ê³µê°œ ê¸€ì€ í•´ë‹¹ ê´€ë¦¬ì ë‹‰ë„¤ì„ìœ¼ë¡œ ì‘ì„±ëœ ê²ƒë§Œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        //    ë˜ëŠ” my_id ì—†ì´ í˜¸ì¶œ ì‹œ ëª¨ë“  ê³µê°œê¸€ + my_idê°€ adminì¸ ë¹„ê³µê°œ ê¸€ì„ ë°˜í™˜í•˜ë„ë¡ ì„œë²„ê°€ êµ¬í˜„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
        //    ì—¬ê¸°ì„œëŠ” my_idë¥¼ ADMIN_NICKNAMEìœ¼ë¡œ ë³´ë‚´ì„œ í•´ë‹¹ ê´€ë¦¬ìì˜ ë¹„ê³µê°œê¸€ì€ ë³¼ ìˆ˜ ìˆë„ë¡ ì‹œë„í•©ë‹ˆë‹¤.
        const adminUser = getAdminNickname(); // ê´€ë¦¬ì ì‹ë³„ (ì˜ˆ: 'admin')
        try {
            const res = await fetch(`${API_BASE_URL}/posts?my_id=${encodeURIComponent(adminUser)}&show_all_for_admin=true`); // show_all_for_adminì€ ì„œë²„ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” íŒŒë¼ë¯¸í„° ì˜ˆì‹œ
            if (!res.ok) {
                console.error('Failed to fetch all posts. Status:', res.status, res.statusText);
                alert(`ì „ì²´ ê²Œì‹œê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ ì‘ë‹µ: ${res.status}. API ì„œë²„(${API_BASE_URL})ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`);
                return [];
            }
            return await res.json();
        } catch (error) {
            console.error('Error fetching all posts:', error);
            alert(`ì „ì²´ ê²Œì‹œê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ${error.message}\nAPI ì„œë²„(${API_BASE_URL}) ì—°ê²° ë° ê´€ë¦¬ììš© API ì§€ì› ì—¬ë¶€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`);
            return [];
        }
    }

    function formatDate(dateString) {
        if (!dateString) return '-';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ';
            return date.toLocaleString('ko-KR');
        } catch (e) { return 'ë‚ ì§œ ë³€í™˜ ì˜¤ë¥˜'; }
    }

    function renderAdminPostList(posts) {
        const listEl = document.getElementById('admin-post-list');
        const emptyEl = document.getElementById('admin-post-empty');
        if (!listEl || !emptyEl) return;

        listEl.innerHTML = '';
        if (!posts || posts.length === 0) {
            emptyEl.classList.remove('hidden');
            return;
        }
        emptyEl.classList.add('hidden');

        posts.sort((a, b) => b.id - a.id); // ìµœì‹ ê¸€ë¶€í„° ë³´ì´ë„ë¡ ID ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬

        posts.forEach(post => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${post.id}</td>
                <td>${post.writer || 'N/A'}</td>
                <td class="max-w-xs truncate" title="${post.content || ''}">${(post.content || '').substring(0, 30)}${(post.content || '').length > 30 ? '...' : ''}</td>
                <td>${formatDate(post.date)}</td>
                <td>${post.is_private ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-pink-100 text-pink-800">ë¹„ê³µê°œ</span>' : '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">ê³µê°œ</span>'}</td>
                <td class="space-x-2 whitespace-nowrap">
                    <button class="text-indigo-600 hover:text-indigo-900 text-sm admin-edit-post-btn" data-id="${post.id}">ìˆ˜ì •</button>
                    <button class="text-red-600 hover:text-red-900 text-sm admin-delete-post-btn" data-id="${post.id}">ì‚­ì œ</button>
                </td>
            `;
            listEl.appendChild(tr);
        });

        // ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('.admin-edit-post-btn').forEach(button => {
            button.addEventListener('click', function() {
                const postId = this.dataset.id;
                const postToEdit = posts.find(p => p.id.toString() === postId);
                if (postToEdit) {
                    openEditPostModal(postToEdit);
                }
            });
        });

        // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('.admin-delete-post-btn').forEach(button => {
            button.addEventListener('click', async function() {
                const postId = this.dataset.id;
                if (confirm(`ì •ë§ ID ${postId} ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                    // ğŸš¨ ì¤‘ìš”: ê´€ë¦¬ì ì‚­ì œëŠ” my_id ì—†ì´, ë˜ëŠ” ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‚­ì œí•˜ëŠ” APIê°€ í•„ìš”í•©ë‹ˆë‹¤.
                    // í˜„ì¬ëŠ” ì¼ë°˜ ì‚¬ìš©ì ì‚­ì œ APIë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ, ê´€ë¦¬ì ë‹‰ë„¤ì„ìœ¼ë¡œ my_idë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
                    const adminUser = getAdminNickname();
                    try {
                        const res = await fetch(`${API_BASE_URL}/posts/${postId}?my_id=${encodeURIComponent(adminUser)}&is_admin_delete=true`, { // is_admin_deleteëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” íŒŒë¼ë¯¸í„° ì˜ˆì‹œ
                            method: 'DELETE'
                        });
                        const result = await res.json();
                        if (result.success) {
                            alert('ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            loadAllPostsForAdmin();
                        } else {
                            alert(result.error || 'ê²Œì‹œë¬¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        console.error('Error deleting post by admin:', error);
                        alert(`ê²Œì‹œë¬¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}. API ì„œë²„(${API_BASE_URL}) ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.`);
                    }
                }
            });
        });
    }

    async function loadAllPostsForAdmin() {
        const posts = await fetchAllPostsForAdmin();
        renderAdminPostList(posts);
    }

    // --- ê²Œì‹œë¬¼ ìˆ˜ì • ëª¨ë‹¬ ê´€ë ¨ ---
    const editPostModal = document.getElementById('edit-post-modal');
    const editPostModalCloseBtn = document.getElementById('edit-post-modal-close');
    const editPostCancelBtn = document.getElementById('edit-post-cancel');
    const editPostForm = document.getElementById('edit-post-form');

    function openEditPostModal(post) {
        document.getElementById('edit-post-id').value = post.id;
        document.getElementById('edit-post-id-display').textContent = post.id;
        document.getElementById('edit-post-writer').value = post.writer || '';
        document.getElementById('edit-post-content').value = post.content || '';
        document.getElementById('edit-post-private').checked = !!post.is_private;
        document.getElementById('edit-post-error').classList.add('hidden');
        editPostModal.classList.remove('hidden');
    }

    function closeEditPostModal() {
        editPostModal.classList.add('hidden');
    }

    if(editPostModalCloseBtn) editPostModalCloseBtn.onclick = closeEditPostModal;
    if(editPostCancelBtn) editPostCancelBtn.onclick = closeEditPostModal;

    if(editPostForm) {
        editPostForm.onsubmit = async function(e) {
            e.preventDefault();
            const id = document.getElementById('edit-post-id').value;
            const content = document.getElementById('edit-post-content').value.trim();
            const is_private = document.getElementById('edit-post-private').checked;
            const errorDiv = document.getElementById('edit-post-error');
            errorDiv.classList.add('hidden');

            if (!content) {
                errorDiv.textContent = 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // ğŸš¨ ì¤‘ìš”: ê´€ë¦¬ì ìˆ˜ì •ì€ my_id ì—†ì´, ë˜ëŠ” ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ìˆ˜ì •í•˜ëŠ” APIê°€ í•„ìš”í•©ë‹ˆë‹¤.
            // í˜„ì¬ëŠ” ì¼ë°˜ ì‚¬ìš©ì ìˆ˜ì • APIë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ, ê´€ë¦¬ì ë‹‰ë„¤ì„ìœ¼ë¡œ my_idë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
            const adminUser = getAdminNickname();
            try {
                const res = await fetch(`${API_BASE_URL}/posts/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content, is_private, my_id: adminUser, is_admin_edit: true }) // is_admin_editëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” íŒŒë¼ë¯¸í„° ì˜ˆì‹œ
                });
                const result = await res.json();
                if (result.success) {
                    alert('ê²Œì‹œë¬¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeEditPostModal();
                    loadAllPostsForAdmin();
                } else {
                    errorDiv.textContent = result.error || 'ê²Œì‹œë¬¼ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error editing post by admin:', error);
                errorDiv.textContent = `ê²Œì‹œë¬¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}. API ì„œë²„(${API_BASE_URL}) ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.`;
                errorDiv.classList.remove('hidden');
            }
        };
    }


    // --- íšŒì› ê´€ë¦¬ ë¡œì§ ---
    async function fetchAllUsersForAdmin() {
      try {
        const res = await fetch(`${API_BASE_URL}/admin/users?admin_id=${encodeURIComponent(ADMIN_NICKNAME)}`);
        if (!res.ok) return [];
        const data = await res.json();
        return data.users || [];
      } catch (e) { return []; }
    }

    function renderAdminUserList(users) {
      const listEl = document.getElementById('admin-user-list');
      const emptyEl = document.getElementById('admin-user-empty');
      if (!listEl || !emptyEl) return;
      listEl.innerHTML = '';
      if (!users || users.length === 0) {
        emptyEl.classList.remove('hidden');
        return;
      }
      emptyEl.classList.add('hidden');
      users.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.id}</td>
          <td>${user.nickname}</td>
          <td>${user.realname || ''}</td>
          <td>${user.birth || ''}</td>
          <td>${user.contact || ''}</td>
          <td>${user.email || ''}</td>
          <td><button class="text-indigo-600 hover:text-indigo-900 text-sm admin-edit-user-btn" data-id="${user.id}">ìƒì„¸/ìˆ˜ì •</button></td>
        `;
        listEl.appendChild(tr);
      });
      document.querySelectorAll('.admin-edit-user-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
          const userId = this.dataset.id;
          const res = await fetch(`${API_BASE_URL}/admin/users/${userId}?admin_id=${encodeURIComponent(ADMIN_NICKNAME)}`);
          const data = await res.json();
          if (data.success && data.user) openEditUserModal(data.user);
          else alert('íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        });
      });
    }

    async function loadAllUsersForAdmin() {
      const users = await fetchAllUsersForAdmin();
      renderAdminUserList(users);
    }

    // --- íšŒì› ìƒì„¸/ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ ---
    const editUserModal = document.getElementById('edit-user-modal');
    const editUserModalCloseBtn = document.getElementById('edit-user-modal-close');
    const editUserCancelBtn = document.getElementById('edit-user-cancel');
    const editUserForm = document.getElementById('edit-user-form');
    const deleteUserBtn = document.getElementById('delete-user-btn');

    function openEditUserModal(user) {
      document.getElementById('edit-user-id').value = user.id;
      document.getElementById('edit-user-id-display').textContent = user.id;
      document.getElementById('edit-user-nickname').value = user.nickname || '';
      document.getElementById('edit-user-realname').value = user.realname || '';
      document.getElementById('edit-user-birth').value = user.birth || '';
      document.getElementById('edit-user-contact').value = user.contact || '';
      document.getElementById('edit-user-email').value = user.email || '';
      document.getElementById('edit-user-error').classList.add('hidden');
      editUserModal.classList.remove('hidden');
    }
    function closeEditUserModal() { editUserModal.classList.add('hidden'); }
    if(editUserModalCloseBtn) editUserModalCloseBtn.onclick = closeEditUserModal;
    if(editUserCancelBtn) editUserCancelBtn.onclick = closeEditUserModal;

    if(editUserForm) {
      editUserForm.onsubmit = async function(e) {
        e.preventDefault();
        const id = document.getElementById('edit-user-id').value;
        const realname = document.getElementById('edit-user-realname').value.trim();
        const birth = document.getElementById('edit-user-birth').value.trim();
        const contact = document.getElementById('edit-user-contact').value.trim();
        const email = document.getElementById('edit-user-email').value.trim();
        const errorDiv = document.getElementById('edit-user-error');
        errorDiv.classList.add('hidden');
        try {
          const res = await fetch(`${API_BASE_URL}/admin/users/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ admin_id: ADMIN_NICKNAME, realname, birth, contact, email })
          });
          const result = await res.json();
          if (result.success) {
            alert('íšŒì› ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeEditUserModal();
            loadAllUsersForAdmin();
          } else {
            errorDiv.textContent = result.error || 'íšŒì› ì •ë³´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
            errorDiv.classList.remove('hidden');
          }
        } catch (error) {
          errorDiv.textContent = `íšŒì› ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
          errorDiv.classList.remove('hidden');
        }
      };
    }
    if(deleteUserBtn) {
      deleteUserBtn.onclick = async function() {
        const id = document.getElementById('edit-user-id').value;
        if (confirm('ì •ë§ ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          try {
            const res = await fetch(`${API_BASE_URL}/admin/users/${id}?admin_id=${encodeURIComponent(ADMIN_NICKNAME)}`, { method: 'DELETE' });
            const result = await res.json();
            if (result.success) {
              alert('íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
              closeEditUserModal();
              loadAllUsersForAdmin();
            } else {
              alert(result.error || 'íšŒì› ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
          } catch (error) {
            alert(`íšŒì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
          }
        }
      };
    }

    // --- ìƒí’ˆ ê´€ë¦¬ ë¡œì§ ---
    async function fetchAllProducts() {
      try {
        const res = await fetch(`${API_BASE_URL}/products`);
        if (!res.ok) return [];
        return await res.json();
      } catch (e) { return []; }
    }
    function renderAdminProductList(products) {
      const listEl = document.getElementById('admin-product-list');
      const emptyEl = document.getElementById('admin-product-empty');
      if (!listEl || !emptyEl) return;
      listEl.innerHTML = '';
      if (!products || products.length === 0) {
        emptyEl.classList.remove('hidden');
        return;
      }
      emptyEl.classList.add('hidden');
      products.forEach(product => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${product.id}</td>
          <td><input type="text" value="${product.name}" class="border rounded p-1 w-32 admin-edit-product-name"></td>
          <td><input type="text" value="${product.image}" class="border rounded p-1 w-40 admin-edit-product-image"></td>
          <td><input type="text" value="${product.price}" class="border rounded p-1 w-20 admin-edit-product-price"></td>
          <td><input type="text" value="${product.link || ''}" class="border rounded p-1 w-40 admin-edit-product-link"></td>
          <td class="space-x-2">
            <button class="text-blue-600 hover:text-blue-900 text-sm admin-save-product-btn" data-id="${product.id}">ì €ì¥</button>
            <button class="text-red-600 hover:text-red-900 text-sm admin-delete-product-btn" data-id="${product.id}">ì‚­ì œ</button>
          </td>
        `;
        listEl.appendChild(tr);
      });
      // ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-save-product-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
          const id = this.dataset.id;
          const tr = this.closest('tr');
          const name = tr.querySelector('.admin-edit-product-name').value.trim();
          const image = tr.querySelector('.admin-edit-product-image').value.trim();
          const price = tr.querySelector('.admin-edit-product-price').value.trim();
          const link = tr.querySelector('.admin-edit-product-link').value.trim();
          if (!name || !image || !price) { alert('í•„ìˆ˜ í•­ëª© ëˆ„ë½'); return; }
          const res = await fetch(`${API_BASE_URL}/products/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, image, price, link })
          });
          const result = await res.json();
          if (result.success) { alert('ì €ì¥ë¨'); loadAllProducts(); }
          else alert(result.error || 'ì €ì¥ ì‹¤íŒ¨');
        });
      });
      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.admin-delete-product-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
          const id = this.dataset.id;
          if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
          const res = await fetch(`${API_BASE_URL}/products/${id}`, { method: 'DELETE' });
          const result = await res.json();
          if (result.success) { alert('ì‚­ì œë¨'); loadAllProducts(); }
          else alert(result.error || 'ì‚­ì œ ì‹¤íŒ¨');
        });
      });
    }
    async function loadAllProducts() {
      const products = await fetchAllProducts();
      renderAdminProductList(products);
    }
    // ìƒí’ˆ ì¶”ê°€ í¼ ì´ë²¤íŠ¸
    const addProductForm = document.getElementById('add-product-form');
    if (addProductForm) {
      addProductForm.onsubmit = async function(e) {
        e.preventDefault();
        const name = document.getElementById('product-name').value.trim();
        const image = document.getElementById('product-image').value.trim();
        const price = document.getElementById('product-price').value.trim();
        const link = document.getElementById('product-link').value.trim();
        const errorDiv = document.getElementById('product-add-error');
        errorDiv.classList.add('hidden');
        if (!name || !image || !price) {
          errorDiv.textContent = 'ìƒí’ˆëª…, ì´ë¯¸ì§€, ê°€ê²©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.';
          errorDiv.classList.remove('hidden');
          return;
        }
        const res = await fetch(`${API_BASE_URL}/products`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, image, price, link })
        });
        const result = await res.json();
        if (result.id) {
          addProductForm.reset();
          loadAllProducts();
        } else {
          errorDiv.textContent = result.error || 'ìƒí’ˆ ì¶”ê°€ ì‹¤íŒ¨';
          errorDiv.classList.remove('hidden');
        }
      };
    }
    // ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œ ìƒí’ˆ ëª©ë¡ë„ ë¶ˆëŸ¬ì˜¤ê¸°
    function updateAdminUIWithProducts() {
      updateAdminUI();
      if (isAdminLoggedIn()) loadAllProducts();
    }
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ (ìƒí’ˆë„)
    document.addEventListener('DOMContentLoaded', function() {
      updateAdminUIWithProducts();
    });
  </script>
</body>
</html>
